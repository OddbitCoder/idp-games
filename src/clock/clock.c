#include "../common/gdp.h"

typedef struct {
    uint8_t x;
    uint8_t y;
} pt;

typedef struct {
	uint16_t x;
	uint16_t y;
} pt16;

typedef struct {
    pt pt1;
    pt pt2;
} line;

const pt16 digit_pos[] = {
    { 302,  29 }, // 1
    { 335,  65 }, // 2
    { 352, 113 }, // 3
    { 335, 162 }, // 4
    { 298, 203 }, // 5
    { 246, 215 }, // 6
    { 194, 198 }, // 7
    { 157, 162 }, // 8
    { 140, 113 }, // 9
    { 149,  65 }, // 10
    { 189,  29 }, // 11
    { 237,  12 }, // 12
};

const uint8_t *gfx_logo[] = {
	"\x05\xAC\x8C\xDC\x8B\x01",
	"\x06\x8A\x94\x8C\x43\x08\x01",
	"\x07\x8B\xD0\xA1\xA1\xA1\x8A\x03",
	"\x06\x8B\xDA\xDA\xDA\xDB\x01",
	"\x0A\x8B\xD0\x91\xD0\x91\xD0\x91\xD0\x92\x02",
	"\x0A\x8B\xD0\x91\xD0\x91\xD0\x91\xD0\x92\x02",
	"\x06\xA9\xA1\xA1\xA1\x92\x02",
	"\x00",
	"\x00",
	"\x00",
	"\x00",
	"\x00",
	"\x03\x00\x0D\x01",
	"\x03\x00\x0D\x01",
	"\x06\x83\x99\xA1\x99\x99\x04",
	"\x08\x83\x8B\x8A\x8A\x8A\x8B\x8A\x01",
	"\x07\x83\x92\xA2\x91\x92\x91\x01",
	"\x07\x83\x92\x94\x91\x92\x91\x01",
	"\x06\x83\x92\xA2\x91\x92\x04",
};

const uint8_t *gfx_digits[][30] = {
	{ // 1
		"\x01\x0E",
		"\x01\x0E",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
	}, { // 2
		"\x01\x15",
		"\x01\x15",
		"\x02\xAD\x0B",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0A\x0B",
		"\x01\x15",
		"\x01\x15",
		"\x01\x05",
		"\x01\x04",
		"\x01\x04",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xAD\x0B",
		"\x01\x15",
		"\x01\x15",
	}, { // 3
		"\x01\x15",
		"\x01\x15",
		"\x02\xAD\x0B",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0A\x0B",
		"\x02\x86\x0E",
		"\x02\x86\x0D",
		"\x02\x86\x0E",
		"\x03\x00\x0A\x0B",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xAD\x0B",
		"\x01\x15",
		"\x01\x15",
	}, { // 4
		"\x01\x15",
		"\x01\x15",
		"\x02\xAD\x0B",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xAD\x0B",
		"\x01\x18",
		"\x01\x18",
		"\x01\x18",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
	}, { // 5
		"\x01\x15",
		"\x01\x15",
		"\x02\xAD\x0B",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x01\x04",
		"\x01\x04",
		"\x01\x05",
		"\x01\x15",
		"\x01\x15",
		"\x03\x00\x0A\x0B",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xAD\x0B",
		"\x01\x15",
		"\x01\x15",
	}, { // 6
		"\x01\x15",
		"\x01\x15",
		"\x02\xAD\x0B",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x01\x04",
		"\x01\x04",
		"\x01\x05",
		"\x01\x15",
		"\x01\x15",
		"\x01\x15",
		"\x02\xAD\x0B",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xAD\x0B",
		"\x01\x15",
		"\x01\x15",
	}, { // 7
		"\x01\x15",
		"\x01\x15",
		"\x02\xAD\x0B",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0B\x0A",
		"\x03\x00\x0A\x0A",
		"\x03\x00\x0A\x0A",
		"\x03\x00\x09\x0A",
		"\x03\x00\x09\x0A",
		"\x03\x00\x08\x0A",
		"\x03\x00\x08\x0A",
		"\x02\x87\x0A",
		"\x02\x87\x0A",
		"\x02\x86\x0A",
		"\x02\x86\x0A",
		"\x02\x85\x0A",
		"\x02\x85\x0A",
		"\x02\x84\x0A",
		"\x02\x84\x0A",
		"\x02\x83\x0A",
		"\x02\x83\x0A",
	}, { // 8
		"\x01\x15",
		"\x01\x15",
		"\x02\x0B\xAD",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x03\x81\x0A\xAD",
		"\x02\x82\x12",
		"\x02\x81\x12",
		"\x02\xAD\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xA7\x0A",
		"\x02\xAD\x0B",
		"\x01\x15",
		"\x01\x15",
	}, { // 9
		"\x01\x15",
		"\x01\x15",
		"\x02\x0B\xAD",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0B\xAD",
		"\x01\x15",
		"\x01\x15",
		"\x01\x15",
		"\x03\x00\x10\x05",
		"\x03\x00\x11\x04",
		"\x03\x00\x11\x04",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0A\xBC",
		"\x02\x0B\xAD",
		"\x01\x15",
		"\x01\x15",
	}, { // 10
		"\x03\x0E\x03\x14",
		"\x03\x0E\x03\x14",
		"\x05\x84\x0A\x03\x0B\xAC",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0A\xBB",
		"\x05\x84\x0A\x03\x0B\xAC",
		"\x04\x84\x0A\x03\x14",
		"\x04\x84\x0A\x03\x14",	
	}, { // 11
		"\x03\x0E\x02\x0E",
		"\x03\x0E\x02\x0E",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
		"\x04\x84\x0A\x06\x0A",
	}, { // 12
		"\x03\x0E\x03\x15",
		"\x03\x0E\x03\x15",
		"\x05\x84\x0A\x9D\x05\x0B",
		"\x05\x84\x0A\x9C\x07\x0A",
		"\x05\x84\x0A\x9C\x07\x0A",
		"\x05\x84\x0A\x9C\x07\x0A",
		"\x05\x84\x0A\x9C\x07\x0A",
		"\x05\x84\x0A\x9C\x07\x0A",
		"\x05\x84\x0A\x9C\x07\x0A",
		"\x05\x84\x0A\x9C\x07\x0A",
		"\x04\x84\x0A\x0E\x0A",
		"\x04\x84\x0A\x0E\x0A",
		"\x04\x84\x0A\x0E\x0A",
		"\x04\x84\x0A\x0E\x0A",
		"\x04\x84\x0A\x0D\x0B",
		"\x04\x84\x0A\x03\x15",
		"\x04\x84\x0A\x03\x15",
		"\x03\x84\x0A\x9D",
		"\x03\x84\x0A\x9C",
		"\x03\x84\x0A\x9C",
		"\x05\x84\x0A\x9C\x07\x0A",
		"\x05\x84\x0A\x9C\x07\x0A",
		"\x05\x84\x0A\x9C\x07\x0A",
		"\x05\x84\x0A\x9C\x07\x0A",
		"\x05\x84\x0A\x9C\x07\x0A",
		"\x05\x84\x0A\x9C\x07\x0A",
		"\x05\x84\x0A\x9C\x07\x0A",
		"\x05\x84\x0A\x9D\x05\x0B",
		"\x04\x84\x0A\x03\x15",
		"\x04\x84\x0A\x03\x15",
	}
};

const pt16 logo_pos = {
	243, 162
};

#include "hands.h"
#include "hands_bkg.h"

void draw_hand(uint8_t line_count, line *lines, pt16 *x_min, uint8_t tool) {
	for (uint8_t i = 0; i < line_count; i++) {
		gdp_delta_sign sign = 0;
		uint8_t dx = 0;
		uint8_t dy = 0;
		uint16_t pt1_x = lines[i].pt1.x + x_min->x;
		uint16_t pt2_x = lines[i].pt2.x + x_min->y;
		if (pt1_x > pt2_x) {
			sign |= GDP_DELTA_SIGN_DX_NEG;
			dx = pt1_x - pt2_x;
		} else {
			sign |= GDP_DELTA_SIGN_DX_POS;
			dx = pt2_x - pt1_x;
		}
		if (lines[i].pt1.y > lines[i].pt2.y) {
			sign |= GDP_DELTA_SIGN_DY_NEG;
			dy = lines[i].pt1.y - lines[i].pt2.y;
		} else {
			sign |= GDP_DELTA_SIGN_DY_POS;
			dy = lines[i].pt2.y - lines[i].pt1.y;
		}
		gdp_set_xy(pt1_x, lines[i].pt1.y);
		gdp_line_delta(tool, GDP_STYLE_NORMAL, dx, dy, sign);
	}
}

int main() {
	gdp_init();
	gdp_draw(gfx_logo, 18, logo_pos.x << 1, logo_pos.y);
	for (int i = 0; i < 12; i++) {
		gdp_draw(gfx_digits[i], 29, digit_pos[i].x << 1, digit_pos[i].y);
	}
	//while (true) {
		for (int i = 0; i < 60; i++) {
			//gdp_cls();
			draw_hand(line_count_hand_minute_bkg[i], hand_minute_bkg[i], &x_min_hand_minute_bkg[i], GDP_TOOL_ERASER);
			draw_hand(line_count_hand_minute[i], hand_minute[i], &x_min_hand_minute[i], GDP_TOOL_PEN);
			while (!kbhit());

			draw_hand(line_count_hand_minute[i], hand_minute[i], &x_min_hand_minute[i], GDP_TOOL_ERASER);
			//gdp_draw(gfx_dial, 255, 0, 0);
		}
	//}
	
	gdp_done();

	return 0;
}